## 1、小程序的运行原理

微信小程序使用了前端技术栈 JavaScript/WXML/WXSS。但和常规的前端开发又有一些区别：

JavaScript: 微信小程序的 JavaScript 运行环境即不是 Browser 也不是 Node.js。它运行在微信 App 的上下文中，不能操作 Browser context 下的 DOM，也不能通过 Node.js 相关接口访问操作系统 API。所以，严格意义来讲，微信小程序并不是 Html5，虽然开发过程和用到的技术栈和 Html5 是相通的。

WXML: 作为微信小程序的展示层，并不是使用 Html，而是自己发明的基于 XML 语法的描述。

WXSS: 用来修饰展示层的样式。官方的描述是 “ WXSS (WeiXin Style Sheets) 是一套样式语言，用于描述 WXML 的组件样式。WXSS 用来决定 WXML 的组件应该怎么显示。” “我们的 WXSS 具有 CSS 大部分特性...我们对 CSS 进行了扩充以及修改。”基于 CSS2 还是 CSS3？大部分是哪些部分？是否支持 CSS3 里的动画？不得而知。

在微信小程序官方文档上，有下面这段话：

微信小程序运行在三端：iOS、Android 和 用于调试的开发者工具

在 iOS 上，小程序的 javascript 代码是运行在 JavaScriptCore 中
在 Android 上，小程序的 javascript 代码是通过 X5 内核来解析
在 开发工具上， 小程序的 javascript 代码是运行在 nwjs（chrome内核） 中
小程序的 javascript 代码运行在 nwjs 中。nwjs 是什么鬼呢？官方介绍是这样写的：

NW.js (previously known as node-webkit) lets you call all Node.js modules directly from DOM and enables a new way of writing applications with all Web technologies.

nwjs 合并 Browser 和 Node.js 的运行时，可以使用前端开发技术来开发跨平台的应用程序。借助 Node.js 访问操作系统原生 API 的能力，可以开发中跨平台的应用程序。微信小程序开发工具就是使用 nwjs 开发的。

微信小程序的运行环境应该更类似 ReactNative 之类，而不是纯 Html5。两者最大的不同在于，ReactNative 的界面是由原生控件渲染出来的，而 Html5 的界面是由浏览器内核渲染出来的。

原理上，小程序是如何在微信 App 里运行的呢？

微信 App 里包含 javascript 运行引擎。
微信 App 里包含了 WXML/WXSS 处理引擎，最终会把界面翻译成系统原生的控件，并展示出来。这样做的目的是为了提供和原生 App 性能相当的用户体验。
我们来意淫一下小程序加载运行的过程：

- 首先在开发工具中上传源代码到微信服务器，可以开启压缩代码上传
- 用户点击打开一个小程序
- 微信 App 从微信服务器下载这个小程序的源代码
- 分析 app.json 得到应用程序的配置信息（导航栏，窗口样式，包含的页面列表等）
- 加载并运行 app.js
- 加载并显示在 app.json 里配置的第一个页面
- 这个只是从开发者眼中看到的一个简化版的过程，实际过程应该比这要复杂得多，涉及到浏览器线程（就是运行我们的逻辑层代码 app.js 等的线程）和 AppService 线程之间的交互。从官方网站上的一个图片可以看出端倪：

至于微信 App 是如何与小程序的逻辑层 javascript 交互的呢？可以简单地归纳如下：

JavaScript 是脚本语言，可以在运行时解释并执行。微信 App 里包含了一个 JavaScript 引擎，由它来负责执行逻辑层的 JavaScript 代码。那么 JavaScript 调用的小程序相关 API 怎么实现的呢？答案是最终会被翻译成实现在微信 App 里的原生接口。比如开发者调用 wx.getLocation(OBJECT) 获取当前地理位置，微信 App 里的 JavaScript 引擎在执行这个代码时，会去调用微信 App 里实现的原生接口来获取地理位置坐标。

## 2、目前提供的调用native的API

网络请求
上传下载
WebScoket
从本地相册选择图片或使用相机拍照
预览图片。
获取图片信息
录音
音频播放
后台音乐播放
文件操作
数据缓存操作
获取位置，查看位置
地图组件
获取系统信息
获取网络状态
重力感应
罗盘
拨打电话
扫码
提示框，弹窗，actionSheet等
设置导航条
导航历史控制
动画
绘图
下拉刷新
登录
获得用户信息
微信支付
模板消息
客服消息
分享

## 3、已有的组件

视图容器
滚动视图
swiper
图标
文本
进度条
按钮
多项选择器
表单
输入框
标签
滚动选择器
单项选择器
滑动选择器
开关选择器
多行输入框
页面导航链接
音频
图片
视频
地图
画布
客服会话按钮

##4、优缺点list

### 优点：

1 小而美

这和 native 的区别就有了，而这里更欢迎的是服务性的App，也就是张小龙说的「用完即走」。打个比方，比如你想看部电影，同时你又想花最少的钱，这时候你需要比较一下几大购票平台的票价，而你不可能只是为了看场电影把好几个购票 App 都下载了吧（当然不排除有人会这样做），这时微信小程序就有它的优势了。所以我觉得教育、医疗、家政、求职招聘、二手买卖、旅游、票务、金融理财、汽车后市场等等这些付费的服务可能借力因此焕发出第二春。

2 成本

native 的成本只说开发和推广。开发方面，iOS，Android要分开做，各种机型的适配，系统的差异等等；推广方面，打个比方，平均成本三块钱一个下载，就算有几十万下载量，过一两个月剩下的用户能有多少。还有之后巨大的运营成本，巨额的成本将很多想法扼杀在摇篮里。而微信小程序则提供给创业者一个巨大的机会的平台，对于创业者来说，这无疑是一个巨大的风口，有很多人已经不淡定了，认为这是一个划时代的产品，创业热潮即将起航。

3 技术门槛低

对于一些公司或企业来说，能在微信上能够实现的功能，就没必要花大价钱来专门开发一款APP了。而对技术开发公司来说，因为微信上能够实现的这些基础技术，标志技术门槛又一次降低。App的开发商就需要用一个新的姿态和新的想法，来思考他们是否去开发这个App。最大的受益者则是那些想进入互联网行业的创业者，更加标准和低廉的创业成本很可能会成为他们实现创业梦想的重要因素。

### 缺点：

1 小程序无法代替所有的App

说什么微信小程序一出就会消灭80%的 App，都TM瞎扯淡。HTML5出来的时候不是有人说以后就没有 Native App 了，HTML5都出来这么久，现在还不是大把的 Native App，所以还是各有优缺点。不过应该会有不少创业公司在做第一版产品原型的时候会选择这样个平台，快速开发，借助微信庞大的用户量，确实是个不错的选择。但是长远来看，应该还是会做 native。
微信“小程序”产生于 Android 和 iOS 之间，在包罗应用的同时，也是要做到最基本的“遵循行业规则”，至于能不能代替手机App，现在来说还为时过早，对于未知未用的东西，期望值不要过高，个人认为会有影响，但绝对无法做到完全取代（不屑脸）。

2 便捷性

从便捷性的角度讲，微信小程序带来了什么？有更便捷的体验吗？我可以一边玩手机APP一边聊微信，那我可以一边玩微信应用号一边聊微信吗？边看文章边聊微信都没实现（黑人问号脸）？！打开一个 App 手指点击一下就可以了，那我打开微信应用号里的小程序需要几个步骤，打开微信，找到应用号所在位置，找到具体的应用号，最少也要三个步骤，所以微信小程序在便捷性这个角度讲不会比打开管理一个App便捷。(这个问题可以靠设置桌面图标来解决，便捷性是集成服务，而非安装独立 app 来提现)

3 用户体验

小程序归根结底还是一个应用，只是这个小程序是整合了很多App资源的轻应用。既然是一个应用的话，就得提到应用的用户体验。关于微信小程序的体验只是被传得很神，大家都没有实际操作过，也许比我们想象中得要差。比如一些大型游戏的体验根本无法在轻应用完成，而且由于商业竞争的关系，阿里，百度压根不会接入小程序。这么看来，微信小程序的目标群体应该是中小型的低频应用。但是启动速度和交互的流畅如何做到，如何做到与微信互不干扰工作呢？想想我们现在看的时候，根本无法处理微信的消息，想要看微信消息则需要退出重新来一遍，当阅读变成了使用程序，这种体验必将制约丰富功能的 App 的接入使用。而且我认为微信小程序类似 React Native 原理的，而 React Native 最大的缺点是占用内存过高，YY一下会不会有小程序把微信搞奔溃的？
